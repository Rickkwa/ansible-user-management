---

- name: Set variables
  set_fact:
    um_uid_base: 10000
    um_gid_base: 10000
    um_group_inventory:
      - name: customgroup
        rel_gid: 1
        present:
          - all
        absent:
          - all
    um_user_inventory:
      - name: foo
        rel_uid: 1
        present:
          - all
        absent:
          - all
      - name: bar
        rel_uid: 2
        present:
          - all
        absent:
          - all

- name: Set the users to be removed
  loop: "{{ um_user_inventory }}"
  user:
    name: "{{ item.name }}"
    uid: "{{ um_uid_base + item.rel_uid }}"

- name: Debug - show existing groups
  shell: cat /etc/group
  register: existing_groups

- debug:
    var: existing_groups.stdout_lines

- name: Set the group to be removed
  loop: "{{ um_group_inventory }}"
  group:
    name: "{{ item.name }}"
    gid: "{{ um_gid_base + item.rel_gid }}"


- name: Run role
  include_role:
    name: "user_management"


- name: Verify users don't exist
  shell: "! id {{ item.name }}"
  loop: "{{ um_user_inventory }}"

- name: Verify groups don't exist
  shell: "! getent group {{ item.name }}"
  loop: "{{ um_group_inventory }}"
