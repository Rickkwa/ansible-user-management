
notifications:
  email: false

language: python

python: 3.6

env:
  - ANSIBLE_VER=2.5.2
  - ANSIBLE_VER=2.6.1

sudo: true

services:
  - docker

before_install:
  - docker-compose -f tests/docker-compose.yml build
  - docker-compose -f tests/docker-compose.yml up -d
  - sudo mkdir -p /etc/ansible/roles
  - sudo ln -s $TRAVIS_BUILD_DIR /etc/ansible/roles/user_management
  - sudo cp -f $TRAVIS_BUILD_DIR/tests/inventory /etc/ansible/hosts
  # Set host_key_checking = false
  - echo "W2RlZmF1bHRzXQ0KaG9zdF9rZXlfY2hlY2tpbmcgPSBmYWxzZQ==" | base64 -d > ~/.ansible.cfg

install:
  - sudo apt-get install sshpass
  - pip install ansible==$ANSIBLE_VER
  - pip install ansible-lint
script:
  - ansible-lint .
  - |
    for testcase in $(ls tests/cases/); do
      echo -e \"\\033[32m ========== $testcase ========== \\033[0m\"
      ansible-playbook tests/test-role.yml --extra-vars=\"test_case=${testcase}\" -v
    done
